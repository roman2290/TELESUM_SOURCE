Внести изменения в мини-проект на FastAPI. Проект использует библиотеки Telethon и OpenAI для работы с сообщениями пользователя в Telegram и их интеллектуальной обработки.


Задача
Создать функционал, который:
Читает все личные чаты пользователя в Telegram.
Автоматически отправляет новые входящие сообщения от собеседников на обработку в OpenAI (например, для генерации ответов, анализа текста или выполнения других задач).
Возвращает обработанный ответ в Telegram-чат с тем же собеседником, создавая впечатление, что пользователь отвечает в режиме реального времени.
Шаги для реализации изменений:
1. Чтение чатов пользователя
Настройте Telethon-клиент, чтобы подключиться к аккаунту Telegram.
Используйте метод get_dialogs() для получения списка всех чатов, включая личные сообщения, группы и каналы.
Настройте обработчик новых сообщений с помощью client.add_event_handler и события NewMessage.
2. Определение типа чата
Проверьте, является ли чат личным, используя атрибуты event.chat и event.is_private.
Извлеките информацию об отправителе (имя, фамилию, ID) из сообщения с помощью get_sender().
3. Отправка сообщения в OpenAI
Соберите текст нового сообщения из event.message.message.
Используйте OpenAI API для обработки текста. Это делается через метод openai.ChatCompletion.create, где вы передаете сообщение пользователя как ввод для модели.
4. Получение и обработка ответа
Сохраните сгенерированный OpenAI ответ.
Убедитесь, что ответ корректный (например, проверьте длину, отсутствие ошибок).
При необходимости обработайте текст ответа (например, удалите лишние символы или разметку).
5. Отправка ответа в Telegram
Используйте метод event.reply() для отправки OpenAI-ответа обратно в тот же чат.
Добавьте логирование (например, вывод в консоль), чтобы отслеживать, какие сообщения обработаны и отправлены.
